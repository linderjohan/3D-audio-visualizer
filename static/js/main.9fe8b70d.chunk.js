(this["webpackJsonpmy-app"]=this["webpackJsonpmy-app"]||[]).push([[0],{13:function(e,t,i){},19:function(e,t,i){e.exports=i(29)},29:function(e,t,i){"use strict";i.r(t);var s=i(0),a=i.n(s),n=i(15),o=i.n(n),r=(i(13),i(17)),h=i(2),l=i(1),d=i(16),c=new(i.n(d).a);c.showPanel(2),c.showPanel(0),document.body.appendChild(c.dom);class m extends s.Component{constructor(e){super(e),this.state={paused:this.props.paused,analyserNode:this.props.analyserNode},this.start=this.start.bind(this),this.stop=this.stop.bind(this),this.animate=this.animate.bind(this),this.renderScene=this.renderScene.bind(this),this.resize=this.resize.bind(this),this.createRow=this.createRow.bind(this),this.createRandomRow=this.createRandomRow.bind(this),this.updateFrequencies=this.updateFrequencies.bind(this),this.handleScroll=this.handleScroll.bind(this),this.incrementColor=this.incrementColor.bind(this),this.interpolate=this.interpolate.bind(this),this.rotateCamera=this.rotateCamera.bind(this),this.translateCamera=this.translateCamera.bind(this),this.handleDrag=this.handleDrag.bind(this)}handleDrag(e){e.preventDefault(),console.log(e)}rotateCamera(e){}translateCamera(e){console.log(e),this.clientX!==e.clientX&&(this.camera.position.x=0+(e.clientX-this.width/2)/100),this.clientY!==e.clientY&&(this.camera.position.y=20+(-e.clientY+this.height/2)/100),this.clientX=e.clientX,this.clientY=e.clientY}handleScroll(e){this.state.paused&&(this.camera.position.z<3*this.rowamount/8-6&&(this.camera.position.z+=2*e.deltaY,this.pointLight.position.z+=2*e.deltaY),this.camera.position.z>=3*this.rowamount/8-6&&e.deltaY<0&&(this.camera.position.z+=2*e.deltaY,this.pointLight.position.z+=2*e.deltaY))}interpolate(e,t,i){return Math.abs(e+(t-e)*i)}updateFrequencies(){const e=this.state.analyserNode,t=new Uint8Array(e.frequencyBinCount);this.frequencies=[],e.getByteFrequencyData(t);let i=0;for(let s=0;s<this.rowamount+10;++s)if(0===s)this.frequencies.push(1);else if(s>0&&s<5){let e=this.interpolate(this.frequencies[s-1],t[this.index[5]],.02);this.frequencies.push(e),i=this.index[s]}else if(s>this.rowamount)this.frequencies.push(this.interpolate(this.frequencies[s-1],1,.2)),i=this.index[s];else if(s===this.rowamount+10)this.frequencies.push(1);else{let e=0,a=0;for(let h=i;h<=this.index[s+1];h++)t[h]>1&&(a+=t[h],e++);let n=isNaN(a/e)?1:a/e,o=this.interpolate(this.frequencies[s-1],n,.5),r=700*Math.log10(1+o/255);this.frequencies.push(r),i=this.index[s]}}createRow(){let e=new l.d,t=new l.f;for(let d=0;d<this.rowamount+10;++d){let i=new l.a(1,this.frequencies[d]/2.5,1);t=new l.f(i),t.castShadow=!0,t.position.x=d-(this.rowamount+10)/2+.5,t.updateMatrix(),e.merge(t.geometry,t.matrix)}var i=new l.b(1,1,1),s=new l.b(0,1,0);void 0!==this.allrows[0]&&(s=this.incrementColor(this.allrows[0].material.uniforms.colorB.value)),void 0!==this.allrows[0]&&void 0!==this.allrows[1]&&(s=this.incrementColor(this.allrows[0].material.uniforms.colorB.value,this.allrows[1].material.uniforms.colorB.value));let a=l.n.merge([l.l.phong.uniforms,{colorB:{type:"vec3",value:s}},{colorA:{type:"vec3",value:i}}]);var n=new l.m({uniforms:a,fragmentShader:document.getElementById("fragmentShader").textContent,vertexShader:document.getElementById("vertexShader").textContent,lights:!0});let o=new l.f(e,n);this.sceneRoot.add(o),this.allrows.unshift(o);let r=new l.c(e);n=new l.g({color:new l.b(0,0,0,.5),opacity:.2,transparent:!0});let h=new l.e(r,n);this.sceneRoot.add(h),this.allwireframes.unshift(h),this.allwireframes.length>1&&(this.sceneRoot.remove(this.allwireframes[1]),this.allwireframes.pop());this.allrows.length>50&&(this.sceneRoot.remove(this.allrows[50]),this.allrows.pop())}createRandomRow(){let e=new l.a,t=new l.f;for(let o=0;o<this.rowamount;++o){let i=new l.a(1,100*Math.random(),1);t=new l.f(i),t.position.x=o-this.rowamount/2+.5,t.updateMatrix(),e.merge(t.geometry,t.matrix)}var i=new l.b("white");let s={colorB:{type:"vec3",value:new l.b(0,1,0)},colorA:{type:"vec3",value:i}};var a=new l.m({uniforms:s,fragmentShader:document.getElementById("fragmentShader").textContent,vertexShader:document.getElementById("vertexShader").textContent});let n=new l.f(e,a);this.sceneRoot.add(n)}incrementColor(e,t=null){let i=e.r,s=e.g,a=e.b;return null===t?(i+=.001,s-=.001,a+=.001,new l.b(i,s,a)):(i-t.r>0?(i+=.001,i>=1&&(i-=.002)):(i-=.001,i<=.5&&(i+=.002)),s-t.g>0?(s+=.002,s>=1&&(s-=.004)):(s-=.002,s<=.5&&(s+=.004)),a-t.b>0?(a+=.005,a>=1&&(a-=.01)):(a-=.005,a<=.5&&(a+=.01)),new l.b(i,s,a))}resize(e){this.camera.aspect=document.querySelector(".canvas").offsetWidth/document.querySelector(".canvas").offsetHeight,this.camera.updateProjectionMatrix(),this.renderer.setSize(document.querySelector(".canvas").offsetWidth,document.querySelector(".canvas").offsetHeight),this.width=document.querySelector(".canvas").offsetWidth,this.height=document.querySelector(".canvas").offsetHeight}componentDidMount(){this.rowamount=128,this.c=Math.pow(3157,1/Math.pow(this.rowamount,.5)),this.index=[];for(let e=0;e<this.rowamount;++e)this.index.push(Math.ceil(Math.pow(this.c,Math.pow(e,.5))-1));this.now=Date.now(),this.delta=Date.now(),this.then=Date.now(),this.interval=40,window.addEventListener("resize",this.resize),document.querySelector(".canvas").addEventListener("wheel",this.handleScroll),document.querySelector(".canvas").addEventListener("dragstart",this.handleDrag),document.querySelector(".canvas").addEventListener("dragover",this.handleDrag),this.height=document.querySelector(".canvas").offsetHeight,this.width=document.querySelector(".canvas").offsetWidth,this.allrows=[],this.allwireframes=[],this.scene=new l.k,this.sceneRoot=new l.h,this.scene.add(this.sceneRoot),this.camera=new l.i(60,this.width/this.height,5,500),this.camera.position.z=85,this.camera.position.y=20,this.camera.rotation.x=-.05*Math.PI,this.renderer=new l.o({antialias:!0}),this.renderer.setClearColor("#000"),this.renderer.setSize(this.width,this.height),this.mount.appendChild(this.renderer.domElement),this.pointLight=new l.j(15724543,10,300,2),this.pointLight.position.set(0,this.rowamount,this.rowamount),this.pointLight.castShadow=!0,this.scene.add(this.pointLight),this.start()}componentDidUpdate(e){const t=this.props;e!==t&&this.setState({paused:t.paused,analyserNode:t.analyserNode})}componentWillUnmount(){window.removeEventListener("resize",this.resize),document.querySelector(".canvas").removeEventListener("mousewheel",this.handleScroll),document.querySelector(".canvas").removeEventListener("dragstart",this.handleDrag),this.stop(),this.mount.removeChild(this.renderer.domElement)}start(){this.frameId||(this.frameId=requestAnimationFrame(this.animate))}stop(){cancelAnimationFrame(this.frameId)}animate(){this.now=Date.now(),this.delta=this.now-this.then;var e,t,i,s=0;this.delta>this.interval&&(this.state.paused||(c.begin(),this.allrows.forEach((e,t)=>{e.position.z-=2}),e=performance.now(),this.updateFrequencies(),i=performance.now()-e,t=performance.now(),this.createRow(),s=performance.now()-t,c.end()),this.then=this.now-this.delta%this.interval),i>1&&console.log("Tid att uppdatera frekvenser(ms):",i),s>20&&console.log("Tid att skapa en row(ms):",s),this.renderScene(),this.frameId=window.requestAnimationFrame(this.animate)}renderScene(){this.renderer.render(this.scene,this.camera)}render(){return a.a.createElement("div",{ref:e=>{this.mount=e}})}}var u=m;class p extends s.Component{render(){return a.a.createElement("div",{align:"center"},a.a.createElement("h1",null,"Ajajaaaaj nu var det n\xe5got som gick lite fel va? "),a.a.createElement("div",null,a.a.createElement("h1",null,"Henke does not approve!")))}}var w=p;class f extends s.Component{render(){return a.a.createElement(r.a,null,a.a.createElement(h.c,null,a.a.createElement(h.a,{exact:!0,path:"/",component:v}),a.a.createElement(h.a,{component:w})))}}class v extends s.Component{constructor(){super(),this.state={loading:!0,paused:!0,displayControls:{display:"none"},analyserNode:{}},this.update=this.update.bind(this),this.imageload=this.imageload.bind(this),this.handleUpload=this.handleUpload.bind(this),this.handlePlay=this.handlePlay.bind(this),this.handlePause=this.handlePause.bind(this)}handlePlay(e){this.setState({paused:!1})}handlePause(e){this.setState({paused:!0})}handleUpload(e){const t=window.AudioContext||window.webkitAudioContext;this.setState({displayControls:{display:"block"}}),this.music=document.getElementById("music"),this.music.src=URL.createObjectURL(e.target.files[0]);let i=new t;const s=i.createMediaElementSource(this.music),a=i.createAnalyser();a.fftSize=8192,s.connect(a),a.connect(i.destination),this.setState({analyserNode:a}),this.frequencies=new Float32Array(a.frequencyBinCount),a.getFloatFrequencyData(this.frequencies)}update(){this.setState({loading:!1})}imageload(e){e.target.style.display="block",e.target.parentNode.childNodes[0].style.display="none"}componentDidMount(){this.update()}render(){return this.state.loading?a.a.createElement("div",{id:"root-loading"},a.a.createElement("div",{className:"root-spinner"})):a.a.createElement("main",{className:"wrapper"},a.a.createElement("div",{className:"canvas",draggable:"true"},a.a.createElement(u,{analyserNode:this.state.analyserNode,paused:this.state.paused})),a.a.createElement("div",{className:"menu"},a.a.createElement("input",{type:"file",id:"input",onChange:this.handleUpload}),a.a.createElement("audio",{id:"music",controls:!0,onPlay:this.handlePlay,onPause:this.handlePause,style:this.state.displayControls})))}}var g=f;Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(a.a.createElement(g,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(e=>{e.unregister()})}},[[19,1,2]]]);
//# sourceMappingURL=main.9fe8b70d.chunk.js.map
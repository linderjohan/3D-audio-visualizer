(this["webpackJsonpmy-app"]=this["webpackJsonpmy-app"]||[]).push([[0],[,,,function(e,t,i){},,,function(e,t,i){e.exports=i(12)},,,,,function(e,t,i){e.exports=i.p+"static/media/sju-sorger.978ee945.mp3"},function(e,t,i){"use strict";i.r(t);var s=i(1),n=i.n(s),a=i(4),o=i.n(a),r=(i(3),i(0)),h=i(5),l=new(i.n(h).a);l.showPanel(2),l.showPanel(0),document.body.appendChild(l.dom);class d extends s.Component{constructor(e){super(e),this.state={paused:this.props.paused,analyserNode:this.props.analyserNode},this.start=this.start.bind(this),this.stop=this.stop.bind(this),this.animate=this.animate.bind(this),this.renderScene=this.renderScene.bind(this),this.resize=this.resize.bind(this),this.createRow=this.createRow.bind(this),this.createRandomRow=this.createRandomRow.bind(this),this.updateFrequencies=this.updateFrequencies.bind(this),this.handleScroll=this.handleScroll.bind(this),this.incrementColor=this.incrementColor.bind(this),this.interpolate=this.interpolate.bind(this),this.rotateCamera=this.rotateCamera.bind(this),this.translateCamera=this.translateCamera.bind(this),this.handleDrag=this.handleDrag.bind(this)}handleDrag(e){e.preventDefault()}rotateCamera(e){}translateCamera(e){this.clientX!==e.clientX&&(this.camera.position.x=0+(e.clientX-this.width/2)/100),this.clientY!==e.clientY&&(this.camera.position.y=20+(-e.clientY+this.height/2)/100),this.clientX=e.clientX,this.clientY=e.clientY}handleScroll(e){this.state.paused&&(this.camera.position.z<3*this.rowamount/8-6&&(this.camera.position.z+=2*e.deltaY,this.pointLight.position.z+=2*e.deltaY),this.camera.position.z>=3*this.rowamount/8-6&&e.deltaY<0&&(this.camera.position.z+=2*e.deltaY,this.pointLight.position.z+=2*e.deltaY))}interpolate(e,t,i){return Math.abs(e+(t-e)*i)}updateFrequencies(){const e=this.state.analyserNode,t=new Uint8Array(e.frequencyBinCount);this.frequencies=[],e.getByteFrequencyData(t);let i=0;for(let s=0;s<this.rowamount+10;++s)if(0===s)this.frequencies.push(1);else if(s>0&&s<5){let e=this.interpolate(this.frequencies[s-1],t[this.index[5]],.02);this.frequencies.push(e),i=this.index[s]}else if(s>this.rowamount)this.frequencies.push(this.interpolate(this.frequencies[s-1],1,.2)),i=this.index[s];else if(s===this.rowamount+10)this.frequencies.push(1);else{let e=0,n=0;for(let h=i;h<=this.index[s+1];h++)t[h]>1&&(n+=t[h],e++);let a=isNaN(n/e)?1:n/e,o=this.interpolate(this.frequencies[s-1],a,.5),r=700*Math.log10(1+o/255);this.frequencies.push(r),i=this.index[s]}}createRow(){let e=new r.d,t=new r.f;for(let d=0;d<this.rowamount+10;++d){let i=new r.a(1,this.frequencies[d]/2.5,1);t=new r.f(i),t.castShadow=!0,t.position.x=d-(this.rowamount+10)/2+.5,t.updateMatrix(),e.merge(t.geometry,t.matrix)}var i=new r.b(1,1,1),s=new r.b(0,1,0);void 0!==this.allrows[0]&&(s=this.incrementColor(this.allrows[0].material.uniforms.colorB.value)),void 0!==this.allrows[0]&&void 0!==this.allrows[1]&&(s=this.incrementColor(this.allrows[0].material.uniforms.colorB.value,this.allrows[1].material.uniforms.colorB.value));let n=r.n.merge([r.l.phong.uniforms,{colorB:{type:"vec3",value:s}},{colorA:{type:"vec3",value:i}}]);var a=new r.m({uniforms:n,fragmentShader:document.getElementById("fragmentShader").textContent,vertexShader:document.getElementById("vertexShader").textContent,lights:!0});let o=new r.f(e,a);this.sceneRoot.add(o),this.allrows.unshift(o);let h=new r.c(e);a=new r.g({color:new r.b(0,0,0,.5),opacity:.2,transparent:!0});let l=new r.e(h,a);this.sceneRoot.add(l),this.allwireframes.unshift(l),this.allwireframes.length>1&&(this.sceneRoot.remove(this.allwireframes[1]),this.allwireframes.pop());this.allrows.length>50&&(this.sceneRoot.remove(this.allrows[50]),this.allrows.pop())}createRandomRow(){let e=new r.a,t=new r.f;for(let o=0;o<this.rowamount;++o){let i=new r.a(1,100*Math.random(),1);t=new r.f(i),t.position.x=o-this.rowamount/2+.5,t.updateMatrix(),e.merge(t.geometry,t.matrix)}var i=new r.b("white");let s={colorB:{type:"vec3",value:new r.b(0,1,0)},colorA:{type:"vec3",value:i}};var n=new r.m({uniforms:s,fragmentShader:document.getElementById("fragmentShader").textContent,vertexShader:document.getElementById("vertexShader").textContent});let a=new r.f(e,n);this.sceneRoot.add(a)}incrementColor(e,t=null){let i=e.r,s=e.g,n=e.b;return null===t?(i+=.001,s-=.001,n+=.001,new r.b(i,s,n)):(i-t.r>0?(i+=.001,i>=1&&(i-=.002)):(i-=.001,i<=.5&&(i+=.002)),s-t.g>0?(s+=.002,s>=1&&(s-=.004)):(s-=.002,s<=.5&&(s+=.004)),n-t.b>0?(n+=.005,n>=1&&(n-=.01)):(n-=.005,n<=.5&&(n+=.01)),new r.b(i,s,n))}resize(e){this.camera.aspect=document.querySelector(".canvas").offsetWidth/document.querySelector(".canvas").offsetHeight,this.camera.updateProjectionMatrix(),this.renderer.setSize(document.querySelector(".canvas").offsetWidth,document.querySelector(".canvas").offsetHeight),this.width=document.querySelector(".canvas").offsetWidth,this.height=document.querySelector(".canvas").offsetHeight}componentDidMount(){this.rowamount=128,this.c=Math.pow(3157,1/Math.pow(this.rowamount,.5)),this.index=[];for(let e=0;e<this.rowamount;++e)this.index.push(Math.ceil(Math.pow(this.c,Math.pow(e,.5))-1));this.now=Date.now(),this.delta=Date.now(),this.then=Date.now(),this.interval=40,window.addEventListener("resize",this.resize),document.querySelector(".canvas").addEventListener("wheel",this.handleScroll),document.querySelector(".canvas").addEventListener("dragstart",this.handleDrag),document.querySelector(".canvas").addEventListener("dragover",this.handleDrag),this.height=document.querySelector(".canvas").offsetHeight,this.width=document.querySelector(".canvas").offsetWidth,this.allrows=[],this.allwireframes=[],this.scene=new r.k,this.sceneRoot=new r.h,this.scene.add(this.sceneRoot),this.camera=new r.i(60,this.width/this.height,5,500),this.camera.position.z=85,this.camera.position.y=20,this.camera.rotation.x=-.05*Math.PI,this.renderer=new r.o({antialias:!0}),this.renderer.setClearColor("#000"),this.renderer.setSize(this.width,this.height),this.mount.appendChild(this.renderer.domElement),this.pointLight=new r.j(15724543,10,300,2),this.pointLight.position.set(0,this.rowamount,this.rowamount),this.pointLight.castShadow=!0,this.scene.add(this.pointLight),this.start()}componentDidUpdate(e){const t=this.props;e!==t&&this.setState({paused:t.paused,analyserNode:t.analyserNode})}componentWillUnmount(){window.removeEventListener("resize",this.resize),document.querySelector(".canvas").removeEventListener("mousewheel",this.handleScroll),document.querySelector(".canvas").removeEventListener("dragstart",this.handleDrag),this.stop(),this.mount.removeChild(this.renderer.domElement)}start(){this.frameId||(this.frameId=requestAnimationFrame(this.animate))}stop(){cancelAnimationFrame(this.frameId)}animate(){this.now=Date.now(),this.delta=this.now-this.then;var e,t;this.delta>this.interval&&(this.state.paused||(l.begin(),this.allrows.forEach((e,t)=>{e.position.z-=2}),e=performance.now(),this.updateFrequencies(),performance.now()-e,t=performance.now(),this.createRow(),performance.now()-t,l.end()),this.then=this.now-this.delta%this.interval),this.renderScene(),this.frameId=window.requestAnimationFrame(this.animate)}renderScene(){this.renderer.render(this.scene,this.camera)}render(){return n.a.createElement("div",{ref:e=>{this.mount=e}})}}var c=d;s.Component;const m=i(11);class u extends s.Component{render(){return n.a.createElement(p,null)}}class p extends s.Component{constructor(){super(),this.state={loading:!0,created:!1,paused:!0,displayControls:{display:""},analyserNode:{}},this.audioCtx=new AudioContext,this.update=this.update.bind(this),this.imageload=this.imageload.bind(this),this.handleUpload=this.handleUpload.bind(this),this.handlePlay=this.handlePlay.bind(this),this.handlePause=this.handlePause.bind(this)}handlePlay(e){"running"!==this.audioCtx.state&&this.audioCtx.resume(),this.setState({paused:!1})}handlePause(e){this.setState({paused:!0})}handleUpload(e){this.setState({displayControls:{display:"block"}})}update(){this.setState({loading:!1})}imageload(e){e.target.style.display="block",e.target.parentNode.childNodes[0].style.display="none"}componentDidMount(){window.AudioContext||window.webkitAudioContext;this.setState({created:!0}),this.music=document.getElementById("music"),this.music.src=m;const e=this.audioCtx.createMediaElementSource(this.music),t=this.audioCtx.createAnalyser();t.fftSize=8192,e.connect(t),t.connect(this.audioCtx.destination),this.setState({analyserNode:t}),this.frequencies=new Float32Array(t.frequencyBinCount),t.getFloatFrequencyData(this.frequencies)}componentWillUnmount(){this.setState({paused:!0})}componentDidUpdate(){}render(){return n.a.createElement("main",{className:"wrapper"},n.a.createElement("div",{className:"canvas",draggable:"true"},n.a.createElement(c,{analyserNode:this.state.analyserNode,paused:this.state.paused})),n.a.createElement("div",{className:"menu"},n.a.createElement("audio",{id:"music",controls:!0,onPlay:this.handlePlay,onPause:this.handlePause,style:this.state.displayControls})))}}var w=u;Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(n.a.createElement(w,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(e=>{e.unregister()})}],[[6,1,2]]]);
//# sourceMappingURL=main.b3e9922b.chunk.js.map